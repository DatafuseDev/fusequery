statement ok
drop database if exists test_index

statement ok
create database test_index

statement ok
use test_index


statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of aggregate_index requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
DROP AGGREGATING INDEX IF EXISTS testi;

statement ok
CREATE TABLE t (a int, b int, c int)

statement ok
INSERT INTO t VALUES (1,1,4), (1,2,1), (1,2,4), (2,2,5)

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of aggregate_index requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
CREATE AGGREGATING INDEX testi AS SELECT b, MAX(a), SUM(a) from t WHERE c > 1 GROUP BY b

statement error mysql client error: Input/output error: Input/output error: connection closed
REFRESH AGGREGATING INDEX testi

query error mysql client error: Input/output error: Input/output error: Driver error: `Connection to the server is closed\.'
SELECT b from t WHERE c > 1 GROUP BY b ORDER BY b

query error mysql client error: Input/output error: Input/output error: Driver error: `Connection to the server is closed\.'
SELECT b, SUM(a) from t WHERE c > 1 GROUP BY b ORDER BY b
