## Copyright 2023 Databend Cloud
##
## Licensed under the Elastic License, Version 2.0 (the "License");
## you may not use this file except in compliance with the License.
## You may obtain a copy of the License at
##
##     https://www.elastic.co/licensing/elastic-license
##
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an "AS IS" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.

statement ok
drop database if exists test_index

statement ok
create database test_index

statement ok
use test_index

statement ok
CREATE TABLE t (id int, content string)

statement ok
INSERT INTO t VALUES 
(1, 'The quick brown fox jumps over the lazy dog'),
(2, 'A picture is worth a thousand words'),
(3, 'The early bird catches the worm'),
(4, 'Actions speak louder than words'),
(5, 'Time flies like an arrow; fruit flies like a banana'),
(6, 'Beauty is in the eye of the beholder'),
(7, 'When life gives you lemons, make lemonade'),
(8, 'Put all your eggs in one basket'),
(9, 'You can not judge a book by its cover'),
(10, 'An apple a day keeps the doctor away')

statement ok
CREATE INVERTED INDEX IF NOT EXISTS idx1 ON t(content)

statement ok
REFRESH INVERTED INDEX idx1 ON t

ITF
SELECT id, score(), content FROM t WHERE match(content, 'test')
----


ITF
SELECT id, score(), content FROM t WHERE match(content, 'is')
----
2 1.5310525 A picture is worth a thousand words
6 1.4503763 Beauty is in the eye of the beholder

ITF
SELECT id, score(), content FROM t WHERE match(content, 'fly')
----
5 2.5161204 Time flies like an arrow; fruit flies like a banana

ITF
SELECT id, score(), content FROM t WHERE match(content, 'the')
----
1 1.1684625 The quick brown fox jumps over the lazy dog
3 1.3063492 The early bird catches the worm
6 1.2110724 Beauty is in the eye of the beholder
10 0.87497854 An apple a day keeps the doctor away

statement ok
INSERT INTO t VALUES 
(11, 'A stitch in time saves nine'),
(12, 'Barking up the wrong tree'),
(13, 'Better late than never'),
(14, 'Caught between a rock and a hard place'),
(15, 'Do not count your chickens before they hatch'),
(16, 'Every cloud has a silver lining'),
(17, 'Fish out of water'),
(18, 'Grain of salt'),
(19, 'Kill two birds with one stone'),
(20, 'Let the cat out of the bag'),
(21, 'On thin ice'),
(22, 'Raining cats and dogs'),
(23, 'The elephant in the room')

statement error 1105
SELECT id, content, score() FROM t WHERE match(content, 'the') ORDER BY score()

statement ok
REFRESH INVERTED INDEX idx1 ON t

IFT
SELECT id, score(), content FROM t WHERE match(content, 'the') ORDER BY score()
----
10 0.87497854 An apple a day keeps the doctor away
1 1.1684625 The quick brown fox jumps over the lazy dog
6 1.2110724 Beauty is in the eye of the beholder
3 1.3063492 The early bird catches the worm
12 1.4199694 Barking up the wrong tree
20 1.7492892 Let the cat out of the bag
23 1.9377484 The elephant in the room

IFT
SELECT id, score(), content FROM t WHERE match(content, 'your') ORDER BY score()
----
15 1.8497508 Do not count your chickens before they hatch
8 2.0589268 Put all your eggs in one basket

IFT
SELECT id, score(), content FROM t WHERE match(content, ';') ORDER BY score()
----


statement ok
use default

statement ok
drop database test_index
