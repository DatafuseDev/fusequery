## Copyright 2023 Databend Cloud
##
## Licensed under the Elastic License, Version 2.0 (the "License");
## you may not use this file except in compliance with the License.
## You may obtain a copy of the License at
##
##     https://www.elastic.co/licensing/elastic-license
##
## Unless required by applicable law or agreed to in writing, software
## distributed under the License is distributed on an "AS IS" BASIS,
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
## See the License for the specific language governing permissions and
## limitations under the License.

statement ok
DROP DATABASE IF EXISTS test_virtual_db

statement ok
CREATE DATABASE test_virtual_db

statement ok
USE test_virtual_db

statement ok
DROP TABLE IF EXISTS t1

statement ok
CREATE TABLE t1(a int, v json) Engine = Fuse

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of virtual_columns requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
ALTER VIRTUAL COLUMNS (v['k1'], v:k2, v[0]) FOR t1;

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of virtual_columns requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
DROP VIRTUAL COLUMNS FOR t1;

statement error 1065
CREATE VIRTUAL COLUMNS (v) FOR t1;

statement error 1065
CREATE VIRTUAL COLUMNS (a['k1']) FOR t1;

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of virtual_columns requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
CREATE VIRTUAL COLUMNS (v['k1'], v:k2, v[0]) FOR t1;

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of virtual_columns requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
CREATE VIRTUAL COLUMNS (v['k1'], v:k2, v[0]) FOR t1;

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of virtual_columns requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
ALTER VIRTUAL COLUMNS (v['k1']['k2'], v[1][2], v[3]) FOR t1;

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of virtual_columns requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
DROP VIRTUAL COLUMNS FOR t1;

statement error mysql client error: Server error: `ERROR HY000 \(1105\): LicenseKeyInvalid\. Code: 1402, Text = use of virtual_columns requires an enterprise license\. current license is invalid for test_tenant, cause: LicenseKeyParseError\. Code: 1401, Text = jwt claim decode failed, cause: Token has expired\.\.'
GENERATE VIRTUAL COLUMNS FOR t1;

statement ok
USE default

statement ok
DROP DATABASE IF EXISTS test_virtual_db
