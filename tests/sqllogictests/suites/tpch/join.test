statement ok
set sandbox_tenant = 'test_tenant';

statement ok
use tpch_test;

query I
select
    c_custkey, count(o_orderkey) as c_count
from
    customer
        full outer join
    orders
    on c_custkey = o_custkey
        and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
group by
    c_custkey
order by c_custkey
    limit 20;
----
1 0
2 0
3 0
4 0
5 0
6 0
7 0
8 0
9 0
10 0
11 0
12 0
13 0
14 0
15 0
16 0
17 0
18 0
19 0
20 0


query I
select
    c_custkey
from
    customer
        inner join
    orders
    on c_custkey = o_custkey
        and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120 order by c_custkey limit 20;
----
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101

query I
select
    c_custkey, count(o_orderkey) as c_count
from
    customer
        left join
    orders
    on c_custkey = o_custkey
        and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
group by
    c_custkey
order by c_custkey
    limit 20;
----
1 0
2 0
3 0
4 0
5 0
6 0
7 0
8 0
9 0
10 0
11 0
12 0
13 0
14 0
15 0
16 0
17 0
18 0
19 0
20 0


query I
select
    c_custkey, count(o_orderkey) as c_count
from
    customer
        right join
    orders
    on c_custkey = o_custkey
        and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
group by
    c_custkey
order by c_custkey
limit 20;
----
101 48
103 72
104 28
106 72
107 48
109 100
110 36
112 76
113 68
115 112
116 16
118 72
119 40
NULL 299606

query I
select
    c_custkey
from
    customer
        left semi join
    orders
    on c_custkey = o_custkey
        and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
order by c_custkey
    limit 20;
----
101
101
103
103
104
104
106
106
107
107
109
109
110
110
112
112
113
113
115
115

query I
select
    o_custkey
from
    customer
    right semi join
    orders
on c_custkey = o_custkey
    and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
order by o_custkey
    limit 20;
----
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101
101

query I
select
    c_custkey
from
    customer
    left anti join
    orders
on c_custkey = o_custkey
    and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
order by c_custkey
    limit 20;
----
1
1
2
2
3
3
4
4
5
5
6
6
7
7
8
8
9
9
10
10

query I
select
    o_custkey
from
    customer
    right anti join
    orders
on c_custkey = o_custkey
    and o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
order by o_custkey
    limit 20;
----
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
2
2

query I
select
    o_comment
from
    customer
    cross join
    orders
where o_comment not like '%pending%deposits%' and c_custkey > 100 and c_custkey < 120
order by o_comment
    limit 20;
----
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a
 Tiresias about the blithely ironic a

statement ok
set max_block_size = 1024;


# Test iejoin with large dataset
query I
select l_orderkey from (select * from lineitem order by l_orderkey limit 5000) as l, (select * from orders order by o_orderkey limit 5000) as o where l.l_orderkey > o.o_orderkey and l.l_partkey < o.o_custkey order by l_orderkey limit 10;
----
3
3
3
3
3
3
3
3
3
3

statement ok
set max_block_size = 65536;

query I
select l_orderkey from (select * from lineitem order by l_orderkey limit 5000) as l, (select * from orders order by o_orderkey limit 5000) as o where l.l_orderkey > o.o_orderkey order by l_orderkey limit 10;
----
2
2
2
2
3
3
3
3
3
3

# LEFT OUTER / LEFT SINGEL / FULL
query I
select l_orderkey, o_orderdate, o_shippriority from lineitem left join orders on l_orderkey = o_orderkey  and o_orderdate < to_date('1995-03-15') order by o_orderdate, l_orderkey limit 5;
----
3271 1992-01-01 0
3271 1992-01-01 0
3271 1992-01-01 0
3271 1992-01-01 0
3271 1992-01-01 0

# LEFT ANTI
query I
select o_custkey from orders where not exists (select * from customer where substring(c_phone from 1 for 2) in ('13', '31', '23', '29', '30', '18', '17') and o_custkey = c_custkey) order by o_custkey limit 10;
----
1
1
1
1
1
1
1
1
1
1
