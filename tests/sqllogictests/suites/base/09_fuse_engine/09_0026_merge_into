statement ok
set enable_unstable_merge_into = 1;

statement ok
drop table if exists t1;

statement ok
drop table if exists t2;

statement ok
create table t1(a int,b string, c string);

statement ok
create table t2(a int,b string, c string);

statement ok
insert into t1 values(1,'b1','c1'),(2,'b2','c2');

statement ok
insert into t1 values(2,'b3','c3'),(3,'b4','c4');

query TTT
select * from t1 order by a;
----
1 b1 c1
2 b2 c2
2 b3 c3
3 b4 c4

statement ok
insert into t2 values(1,'b_5','c_5'),(3,'b_6','c_6');

statement ok
insert into t2 values(2,'b_7','c_7'); 

query TTT
select * from t2 order by a;
----
1 b_5 c_5
2 b_7 c_7
3 b_6 c_6

statement error 1006
merge into t1 using (select * from t2 as t2) on t1.a = t2.a  when matched then update set t1.c = t2.c,t1.c = t2.c;

statement error 1006
merge into t1 using (select * from t2 as t2) on t1.a = t2.a  when matched then update set t1.c = t2.c  when not matched then insert (a,b) values(t2.a,t2.b);

statement ok
merge into t1 using (select * from t2 as t2) on t1.a = t2.a  when matched then update set t1.c = t2.c;

query TTT
select * from t1 order by a;
----
1 b1 c_5
2 b2 c_7
2 b3 c_7
3 b4 c_6

statement ok
insert into t2 values(4,'b_8','c_8'); 

query TTT
select * from t2 order by a;
----
1 b_5 c_5
2 b_7 c_7
3 b_6 c_6
4 b_8 c_8

statement ok
merge into t1 using (select * from t2 as t2) on t1.a = t2.a  when matched then update set t1.c = t2.c  when not matched then insert (a,b,c) values(t2.a,t2.b,t2.c);

query TTT
select * from t1 order by a;
----
1 b1 c_5
2 b2 c_7
2 b3 c_7
3 b4 c_6
4 b_8 c_8