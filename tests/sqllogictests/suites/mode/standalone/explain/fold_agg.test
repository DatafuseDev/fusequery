statement ok
drop table if exists t

statement ok
create table t(number int, name string, money decimal(15, 2), day date, ts timestamp) as
 select number, number::string, number, '2024-01-01'::Date + number, '2024-01-01'::Timestamp + number * 1e6 from numbers(1000)

query T
explain select count(*) from t
----
EvalScalar
├── output columns: [COUNT(*) (#5)]
├── expressions: [1000]
├── estimated rows: 1.00
└── DummyTableScan

query T
explain select count(*) from (select * from t limit 10 offset 3)
----
EvalScalar
├── output columns: [COUNT(*) (#5)]
├── expressions: [10]
├── estimated rows: 1.00
└── DummyTableScan

query T
explain select count(*) from (select * from t limit 10 offset 999)
----
EvalScalar
├── output columns: [COUNT(*) (#5)]
├── expressions: [1]
├── estimated rows: 1.00
└── DummyTableScan


query T
explain select count(*) from (select floor(row_number() over (order by number)) from t)
----
EvalScalar
├── output columns: [COUNT(*) (#7)]
├── expressions: [1000]
├── estimated rows: 1.00
└── DummyTableScan

query T
explain select count(*) from (select number, floor(row_number() over (order by number)) from t)
----
EvalScalar
├── output columns: [COUNT(*) (#7)]
├── expressions: [1000]
├── estimated rows: 1.00
└── DummyTableScan


statement error mysql client error: Server error: `ERROR HY000 \(1105\): TableSchemaMismatch\. Code: 1303, Text = Table columns count is not match, expect 5, input: 1, expr: \[Literal \{ span: Some\(1\.\.2\), value: UInt64\(1\) \}\]\.'
insert into t values(1)

query T
explain select count(*) from t
----
EvalScalar
├── output columns: [COUNT(*) (#5)]
├── expressions: [1000]
├── estimated rows: 1.00
└── DummyTableScan

query T
explain select count(*) from t where number > 10
----
AggregateFinal
├── output columns: [COUNT(*) (#5)]
├── group by: []
├── aggregate functions: [count()]
├── estimated rows: 1.00
└── AggregatePartial
    ├── group by: []
    ├── aggregate functions: [count()]
    ├── estimated rows: 1.00
    └── Filter
        ├── output columns: []
        ├── filters: [is_true(t.number (#0) > 10)]
        ├── estimated rows: 989.00
        └── TableScan
            ├── table: default.default.t
            ├── output columns: [number (#0)]
            ├── read rows: 1000
            ├── read size: 1.88 KiB
            ├── partitions total: 1
            ├── partitions scanned: 1
            ├── pruning stats: [segments: <range pruning: 1 to 1>, blocks: <range pruning: 1 to 1>]
            ├── push downs: [filters: [is_true(t.number (#0) > 10)], limit: NONE]
            └── estimated rows: 1000.00

query T
explain select count(*) from t group by number
----
AggregateFinal
├── output columns: [COUNT(*) (#5), t.number (#0)]
├── group by: [number]
├── aggregate functions: [count()]
├── estimated rows: 1000.00
└── AggregatePartial
    ├── group by: [number]
    ├── aggregate functions: [count()]
    ├── estimated rows: 1000.00
    └── TableScan
        ├── table: default.default.t
        ├── output columns: [number (#0)]
        ├── read rows: 1000
        ├── read size: 1.88 KiB
        ├── partitions total: 1
        ├── partitions scanned: 1
        ├── pruning stats: [segments: <range pruning: 1 to 1>, blocks: <range pruning: 1 to 1>]
        ├── push downs: [filters: [], limit: NONE]
        └── estimated rows: 1000.00

query T
explain select max(number) + 3, min(day) from t;
----
EvalScalar
├── output columns: [min(day) (#6), max(number) + 3 (#7)]
├── expressions: [max(number) (#5) + 3]
├── estimated rows: 1.00
└── EvalScalar
    ├── output columns: [max(number) (#5), min(day) (#6)]
    ├── expressions: [999, '2024-01-01']
    ├── estimated rows: 1.00
    └── DummyTableScan

query T
explain select max(number) + 4,  sum(number), min(day), max(ts), min(money), 8, min(ts), sum(money) from t;
----
EvalScalar
├── output columns: [sum(number) (#6), sum(money) (#11), min(day) (#7), max(ts) (#8), min(money) (#9), min(ts) (#10), max(number) + 4 (#12), 8 (#13)]
├── expressions: [max(number) (#5) + 4, 8]
├── estimated rows: 1.00
└── EvalScalar
    ├── output columns: [sum(number) (#6), sum(money) (#11), max(number) (#5), min(day) (#7), max(ts) (#8), min(money) (#9), min(ts) (#10)]
    ├── expressions: [999, '2024-01-01', '2024-01-01 00:16:39.000000', 0.00, '2024-01-01 00:00:00.000000']
    ├── estimated rows: 1.00
    └── AggregateFinal
        ├── output columns: [sum(number) (#6), sum(money) (#11)]
        ├── group by: []
        ├── aggregate functions: [sum(number), sum(money)]
        ├── estimated rows: 1.00
        └── AggregatePartial
            ├── group by: []
            ├── aggregate functions: [sum(number), sum(money)]
            ├── estimated rows: 1.00
            └── TableScan
                ├── table: default.default.t
                ├── output columns: [number (#0), money (#2)]
                ├── read rows: 1000
                ├── read size: 3.46 KiB
                ├── partitions total: 1
                ├── partitions scanned: 1
                ├── pruning stats: [segments: <range pruning: 1 to 1>, blocks: <range pruning: 1 to 1>]
                ├── push downs: [filters: [], limit: NONE]
                └── estimated rows: 1000.00

query T
explain select 5,  min(number), max(ts), min(money), 4 from t;
----
EvalScalar
├── output columns: [min(number) (#5), max(ts) (#6), min(money) (#7), 5 (#8), 4 (#9)]
├── expressions: [5, 4]
├── estimated rows: 1.00
└── EvalScalar
    ├── output columns: [min(number) (#5), max(ts) (#6), min(money) (#7)]
    ├── expressions: [0, '2024-01-01 00:16:39.000000', 0.00]
    ├── estimated rows: 1.00
    └── DummyTableScan

query T
----
explain select 5,  sum(number), sum(money), 4 from t;
----
EvalScalar
├── output columns: [sum(number) (#5), sum(money) (#6), 5 (#7), 4 (#8)]
├── expressions: [5, 4]
├── estimated rows: 1.00
└── AggregateFinal
    ├── output columns: [sum(number) (#5), sum(money) (#6)]
    ├── group by: []
    ├── aggregate functions: [sum(number), sum(money)]
    ├── estimated rows: 1.00
    └── AggregatePartial
        ├── group by: []
        ├── aggregate functions: [sum(number), sum(money)]
        ├── estimated rows: 1.00
        └── TableScan
            ├── table: default.default.t
            ├── output columns: [number (#0), money (#2)]
            ├── read rows: 1000
            ├── read size: 3.46 KiB
            ├── partitions total: 1
            ├── partitions scanned: 1
            ├── pruning stats: [segments: <range pruning: 1 to 1>, blocks: <range pruning: 1 to 1>]
            ├── push downs: [filters: [], limit: NONE]
            └── estimated rows: 1000.00

statement ok
drop table t
