statement ok
set sandbox_tenant = 'test_tenant';

statement ok
use tpcds;

onlyif mysql
query I
WITH results AS materialized
  (SELECT i_item_id,
          s_state,
          0 AS g_state,
          ss_quantity agg1,
          ss_list_price agg2,
          ss_coupon_amt agg3,
          ss_sales_price agg4
   FROM store_sales,
        customer_demographics,
        date_dim,
        store,
        item
   WHERE ss_sold_date_sk = d_date_sk
     AND ss_item_sk = i_item_sk
     AND ss_store_sk = s_store_sk
     AND ss_cdemo_sk = cd_demo_sk
     AND cd_gender = 'M'
     AND cd_marital_status = 'S'
     AND cd_education_status = 'College'
     AND d_year = 2002
     AND s_state = 'TN' )
SELECT i_item_id,
       s_state,
       g_state,
       agg1,
       agg2,
       agg3,
       agg4
FROM
  ( SELECT i_item_id,
           s_state,
           0 AS g_state,
           avg(agg1) agg1,
           avg(agg2) agg2,
           avg(agg3) agg3,
           avg(agg4) agg4
   FROM results
   GROUP BY i_item_id ,
            s_state
   ) foo
ORDER BY i_item_id NULLS FIRST,
         s_state NULLS FIRST
LIMIT 100;
----
AAAAAAAAACAAAAAA TN 0 54.0 107.9700 0.0000 0.0000
AAAAAAAAAEAAAAAA TN 0 91.0 63.9500 0.0000 14.0600
AAAAAAAAAHAAAAAA TN 0 66.5 59.5350 2542.4500 47.7000
AAAAAAAAAIAAAAAA TN 0 75.0 124.3100 2580.6000 74.8650
AAAAAAAAAKAAAAAA TN 0 36.0 68.5033 0.0000 50.5033
AAAAAAAAALAAAAAA TN 0 85.0 25.2400 0.0000 3.5300
AAAAAAAACCAAAAAA TN 0 40.0 90.5050 365.3800 23.3250
AAAAAAAACDAAAAAA TN 0 22.666666666666668 167.2100 189.3600 123.8500
AAAAAAAACFAAAAAA TN 0 93.0 99.4800 0.0000 38.7900
AAAAAAAACIAAAAAA TN 0 44.0 96.8833 0.0000 66.7266
AAAAAAAACJAAAAAA TN 0 23.0 103.9600 0.0000 35.1750
AAAAAAAACLAAAAAA TN 0 1.0 99.2100 0.0000 23.8100
AAAAAAAADBAAAAAA TN 0 2.0 59.5400 0.0000 57.7500
AAAAAAAADEAAAAAA TN 0 20.666666666666668 50.2100 2.5233 16.2233
AAAAAAAADHAAAAAA TN 0 54.0 72.4600 0.0000 23.1800
AAAAAAAADKAAAAAA TN 0 57.0 116.6500 0.0000 116.6500
AAAAAAAAEAAAAAAA TN 0 96.0 18.8800 0.0000 0.1800
AAAAAAAAEBAAAAAA TN 0 89.0 72.0200 198.6400 3.6000
AAAAAAAAEEAAAAAA TN 0 65.66666666666667 72.0966 0.0000 36.2200
AAAAAAAAEHAAAAAA TN 0 47.0 103.8050 0.0000 50.5250
AAAAAAAAEJAAAAAA TN 0 41.5 74.6350 148.8300 21.2600
AAAAAAAAEKAAAAAA TN 0 53.0 78.3600 0.0000 13.3200
AAAAAAAAFCAAAAAA TN 0 58.0 31.9966 0.8033 8.7066
AAAAAAAAFIAAAAAA TN 0 61.5 106.5300 0.0000 38.9200
AAAAAAAAGCAAAAAA TN 0 96.0 68.0200 0.0000 14.2800
AAAAAAAAGHAAAAAA TN 0 89.0 68.0500 499.2900 7.4800
AAAAAAAAHDAAAAAA TN 0 62.0 93.6300 0.0000 3.7400
AAAAAAAAHJAAAAAA TN 0 76.33333333333333 88.6033 471.8266 40.7500
AAAAAAAAIAAAAAAA TN 0 63.0 89.8800 0.0000 70.1000
AAAAAAAAICAAAAAA TN 0 9.0 84.6600 0.0000 11.8500
AAAAAAAAIDAAAAAA TN 0 87.0 9.4800 0.0000 7.2000
AAAAAAAAIGAAAAAA TN 0 66.0 23.5900 0.0000 11.0800
AAAAAAAAIIAAAAAA TN 0 20.0 68.8500 0.0000 53.7000
AAAAAAAAJKAAAAAA TN 0 97.0 39.4500 0.0000 24.0600
AAAAAAAAKAAAAAAA TN 0 56.0 64.0400 0.0000 61.4700
AAAAAAAAKDAAAAAA TN 0 36.0 31.7700 0.0000 30.1800
AAAAAAAALCAAAAAA TN 0 34.0 147.0800 1912.6500 125.0100
AAAAAAAAMBAAAAAA TN 0 60.0 71.1300 0.0000 11.3800
AAAAAAAAMCAAAAAA TN 0 55.666666666666664 38.2233 436.1866 21.2266
AAAAAAAAMEAAAAAA TN 0 55.5 150.4100 0.0000 107.4350
AAAAAAAAMFAAAAAA TN 0 10.0 97.6900 0.0000 93.7800
AAAAAAAAMHAAAAAA TN 0 48.0 59.9650 0.0000 15.9100
AAAAAAAANAAAAAAA TN 0 65.5 70.5400 0.0000 68.4200
AAAAAAAANDAAAAAA TN 0 88.0 162.7200 0.0000 60.2000
AAAAAAAANGAAAAAA TN 0 27.666666666666668 92.2466 201.9433 78.6200
AAAAAAAAOAAAAAAA TN 0 6.0 22.9700 0.0000 12.8600
AAAAAAAAOCAAAAAA TN 0 76.0 50.8800 0.0000 30.0100
AAAAAAAAODAAAAAA TN 0 26.0 100.0850 0.0000 73.2350
AAAAAAAAOFAAAAAA TN 0 68.0 94.6200 2432.0800 39.7400
AAAAAAAAOIAAAAAA TN 0 17.0 25.9300 0.0000 23.5900
AAAAAAAAOJAAAAAA TN 0 26.0 150.2800 0.0000 34.5600
AAAAAAAAPEAAAAAA TN 0 96.0 72.9600 0.0000 29.9100
AAAAAAAAPHAAAAAA TN 0 58.0 95.5000 0.0000 20.0500
AAAAAAAAPKAAAAAA TN 0 57.5 99.2500 21.8550 21.0150
