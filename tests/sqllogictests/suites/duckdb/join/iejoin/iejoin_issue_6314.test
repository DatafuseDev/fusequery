statement ok
drop table if exists ota;

statement ok
drop table if exists flags;

statement ok
create table ota as select date_add(MINUTE, 15 * i, to_timestamp('2019-04-25 14:10:00')) as ts,  (i * 5 % 100)::INTEGER AS val from generate_series(0,167136,1) t(i);

statement ok
CREATE TABLE flags(my_start TIMESTAMP, my_end TIMESTAMP, my_source VARCHAR, my_desc VARCHAR);

statement ok
INSERT INTO flags VALUES('2019-04-27 06:57:07.210882','2019-05-03 11:47:17.59408','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-05-04 18:31:02.98257','2019-05-04 18:31:03.779477','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-05-06 05:39:26.004945','2019-05-06 05:39:26.239315','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-05-06 20:59:33.37157','2019-05-06 20:59:33.402848','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-05-06 21:14:39.389213','2019-05-06 21:14:39.389213','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-05-06 21:29:41.849197','2019-05-06 21:29:41.880455','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-05-06 23:15:11.014935','2019-05-08 07:04:17.679436','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-05-08 12:11:59.757938','2019-05-08 12:11:59.757938','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-05-10 18:10:50.543442','2019-05-17 03:24:07.564913','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-05-17 10:41:08.933154','2019-05-17 13:11:49.965971','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-05-18 09:40:48.393364','2019-05-22 06:23:59.900634','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-05-28 22:13:49.48383','2019-05-28 22:59:02.257043','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-05-28 23:29:10.768931','2019-05-30 16:09:22.471287','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-06-01 22:16:21.233545','2019-06-01 22:16:21.233545','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-06-03 15:34:27.135046','2019-06-09 04:45:09.435281','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-06-12 16:38:47.439035','2019-06-12 16:38:47.439035','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-06-17 02:38:42.389044','2019-06-18 20:50:36.829324','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-06-18 22:21:02.559667','2019-06-18 22:21:02.559667','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-06-19 18:43:23.96448','2019-07-09 19:57:32.802906','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-07-13 21:55:11.56286','2019-07-13 21:55:11.56286','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-07-16 00:54:34.577846','2019-07-27 11:54:57.069538','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-07-28 09:44:50.873531','2019-07-28 09:44:50.873531','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-07-29 04:30:55.210772','2019-07-29 04:30:55.210772','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-08-01 13:11:12.007762','2019-08-01 13:11:12.007762','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-08-01 20:53:00.104555','2019-08-10 12:22:04.507877','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-08-11 13:34:13.847871','2019-08-11 13:34:13.847871','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-08-12 03:11:45.616815','2019-08-16 12:04:04.771614','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-08-17 03:30:05.751071','2019-08-17 03:30:09.912299','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-08-17 10:18:52','2019-08-18 07:01:58.625201','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-08-18 07:09:41.725062','2019-08-18 07:09:41.725062','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-08-18 12:51:51.684778','2019-08-18 17:23:38.404315','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-08-18 17:27:33.87348','2019-08-19 12:48:02.813164','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-08-19 12:48:03.856232','2019-08-19 12:48:05.153111','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-08-19 13:03:05.546246','2019-08-19 13:03:07.014976','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-08-21 18:48:16.020933','2019-08-21 18:48:17.22906','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-08-21 22:04:12.155626','2019-08-24 20:54:10.580362','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-08-27 01:39:03.415172','2019-09-02 04:50:36.592331','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-09-02 08:09:54.450194','2019-09-02 08:09:54.450194','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-09-03 21:32:04.727393','2019-09-04 21:39:40.521211','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-09-05 01:09:51.078083','2019-09-05 15:59:02.204584','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-09-05 19:31:12.229758','2019-09-06 00:21:01.320128','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-09-07 06:39:57.02327','2019-09-07 11:46:21.22316','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-09-10 17:18:19.409298','2019-09-10 17:18:19.409298','legacy','2/0');

statement ok
INSERT INTO flags VALUES('2019-09-11 22:11:24.748004','2019-09-11 22:11:24.748004','legacy','2/11');

statement ok
INSERT INTO flags VALUES('2019-09-12 18:02:00.344891','2019-09-12 22:33:17.289047','legacy','2/0');

# INNER join
statement ok
drop table if exists inner_join;

statement ok
CREATE TABLE inner_join AS SELECT ota.*, flags.my_desc as flag
FROM ota
INNER JOIN flags ON ota.ts BETWEEN flags.my_start AND flags.my_end
ORDER BY ts;

query III
SELECT COUNT(*), COUNT(ts), COUNT(flag) FROM inner_join
----
8119 8119 8119

# LEFT join
statement ok
drop table if exists left_join;

statement ok
CREATE TABLE left_join AS SELECT ota.*, flags.my_desc as flag
FROM ota
LEFT JOIN flags ON ota.ts BETWEEN flags.my_start AND flags.my_end
ORDER BY ts;

query III
SELECT COUNT(*), COUNT(ts), COUNT(flag) FROM left_join
----
167137 167137 8119

# RIGHT join
statement ok
drop table if exists right_join;

statement ok
CREATE TABLE right_join AS SELECT ota.*, flags.my_desc as flag
FROM ota
RIGHT JOIN flags ON ota.ts BETWEEN flags.my_start AND flags.my_end
ORDER BY ts;

query III
SELECT COUNT(*), COUNT(ts), COUNT(flag) FROM right_join
----
8141 8119 8141

# FULL OUTER join
statement ok
drop table if exists full_outer_join;

statement ok
CREATE TABLE full_outer_join AS SELECT ota.*, flags.my_desc as flag
FROM ota
FULL OUTER JOIN flags ON ota.ts BETWEEN flags.my_start AND flags.my_end
ORDER BY ts;

query III
SELECT COUNT(*), COUNT(ts), COUNT(flag) FROM full_outer_join
----
167159 167137 8141
